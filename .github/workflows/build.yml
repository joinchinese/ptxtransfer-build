    # 1. 编译 Zlib (静态)
    - name: Build Zlib
      shell: powershell
      run: |
        git clone --depth 1 --branch v1.3 https://github.com/madler/zlib.git
        cd zlib
        
        # 创建安装目录（先创建，再 Resolve）
        $installDir = Join-Path (Get-Location).Parent "zlib-install"
        New-Item -ItemType Directory -Force -Path $installDir | Out-Null
        
        # 现在可以安全地 Resolve 了
        $installPath = (Resolve-Path $installDir).Path -replace "\\", "/"
        
        New-Item -ItemType Directory -Force -Path build | Out-Null
        cd build
        cmake .. -G "NMake Makefiles" `
          -DCMAKE_BUILD_TYPE=Release `
          -DCMAKE_INSTALL_PREFIX="$installPath" `
          -DBUILD_SHARED_LIBS=OFF
        if ($LASTEXITCODE -ne 0) { throw "Zlib CMake failed" }
        nmake
        if ($LASTEXITCODE -ne 0) { throw "Zlib build failed" }
        nmake install
        cd ../..
    
    # 2. 编译 Ptex (静态)
    - name: Build Ptex
      shell: powershell
      run: |
        git clone --depth 1 --branch v2.4.2 https://github.com/wdas/ptex.git
        cd ptex
        
        # 确保依赖目录存在
        $zlibDir = Join-Path (Get-Location).Parent "zlib-install"
        $installDir = Join-Path (Get-Location).Parent "ptex-install"
        
        if (-not (Test-Path $zlibDir)) { throw "Zlib install directory not found!" }
        New-Item -ItemType Directory -Force -Path $installDir | Out-Null
        
        $zlibRoot = (Resolve-Path $zlibDir).Path -replace "\\", "/"
        $installPath = (Resolve-Path $installDir).Path -replace "\\", "/"
        
        New-Item -ItemType Directory -Force -Path build | Out-Null
        cd build
        cmake .. -G "NMake Makefiles" `
          -DCMAKE_BUILD_TYPE=Release `
          -DBUILD_SHARED_LIBS=OFF `
          -DPTEX_BUILD_SHARED_LIBS=OFF `
          -DZLIB_ROOT="$zlibRoot" `
          -DZLIB_LIBRARY="$zlibRoot/lib/zlibstatic.lib" `
          -DCMAKE_INSTALL_PREFIX="$installPath"
        if ($LASTEXITCODE -ne 0) { throw "Ptex CMake failed" }
        nmake
        if ($LASTEXITCODE -ne 0) { throw "Ptex build failed" }
        nmake install
        cd ../..
    
    # 3. 编译 ptxutils
    - name: Build Ptxutils
      shell: powershell
      run: |
        git clone --depth 1 https://github.com/wdas/ptexutils.git
        cd ptexutils
        
        # 修改 CMakeLists.txt
        $content = Get-Content CMakeLists.txt -Raw
        $content = $content -replace 'if\(PTEX_FOUND\)', "set(CMAKE_MSVC_RUNTIME_LIBRARY `"MultiThreaded`")`nif(PTEX_FOUND)"
        $content | Set-Content CMakeLists.txt -NoNewline
        
        # 确保依赖存在
        $ptexDir = Join-Path (Get-Location).Parent "ptex-install"
        $zlibDir = Join-Path (Get-Location).Parent "zlib-install"
        
        if (-not (Test-Path $ptexDir)) { throw "Ptex install directory not found!" }
        if (-not (Test-Path $zlibDir)) { throw "Zlib install directory not found!" }
        
        $ptexLoc = (Resolve-Path $ptexDir).Path -replace "\\", "/"
        $zlibRoot = (Resolve-Path $zlibDir).Path -replace "\\", "/"
        
        New-Item -ItemType Directory -Force -Path build | Out-Null
        cd build
        cmake .. -G "NMake Makefiles" `
          -DCMAKE_BUILD_TYPE=Release `
          -DBUILD_SHARED_LIBS=OFF `
          -DPTEX_LOCATION="$ptexLoc" `
          -DZLIB_ROOT="$zlibRoot" `
          -DZLIB_LIBRARY="$zlibRoot/lib/zlibstatic.lib"
        if ($LASTEXITCODE -ne 0) { throw "Ptxutils CMake failed" }
        nmake
        if ($LASTEXITCODE -ne 0) { throw "Ptxutils build failed" }
        cd ../..
